# Callbacks

Every endpoint defined that is called on the FastLoyal API as well as any webhook call made by the FastLoyal API to the client system needs to contain a special X-FL-KEY which is the `API Key` distributed per brand. 
Every callback contains "data" and "signature" fields. 
All callback data is stored inside the "data" field, and the "signature" is being used for the <a href="https://FastLoyal-docs.vercel.app/integration/callbacks#payload-signature" target="_blank" rel="noopener noreferrer" style={{ textDecoration: 'underline', fontStyle: 'italic' }}>payload signature</a> purpose.

## Payload signature

To make every callback more secure and to be sure that no one has altered the request data we are using payload signature. 
Signature is generated by hashing the "data" object using `sha512` algorithm with a secret key (you've have this defined per brand) as key. 

Example in Javascript:
```js
import { createHash } from 'crypto';

const data = {
  userId: 553,
  username: 'ASCRA',
  firstName: 'Mark',
  lastName: 'Zark'
}

const signature = createHmac('sha512', secretKey).update(JSON.stringify(data)).digest('hex');


// Payload example using the data above
const payload = {
  data: {
    userId: 553,
    username: 'ASCRA',
    firstName: 'Mark',
    lastName: 'Zark'
  },
  signature: '558e286b716ce1aa66c983985ba67405174a8cccb8bc7a347c246a3204e9863f33ab2a548125a787357b0ca7a00c1758cf898961772a9f71902283666422a730'
}
```

To be sure everything is secured you should hash the "data" field each time you receive a request and compare it to the "signature" value.

### Callback with payload signature examples

You can check if you've implemented payload signature well by using the "data" field from our example below and `12345` as a brand secret key.
You should generate the same value as in the "signature" field.

```json
{
  "data": {
    "userId": 123,
    "clientItemId": 4567890,
    "metadata": {
      "value": 2000
    }
  },
  "signature": "3e1b9f5de8d74ec0eebe5b70e54361360be3e067adc90744345b2c906e337e9a1fe0057b665f3e101a083452fe7fed9dba06e2edfe9aa114074083a5bcf0e98a"
}

```

## Combine It All Together

As previously mentioned we need to utilize the `X-FL-KEY` as well as the signature with every endpoint, below you will find a couple of examples.

### NodeJS

```javascript
const axios = require('axios');

const data = {
  data: {
    userId: 123,
    clientItemId: 4567890,
    metadata: {
      value: 2000
    }
  },
  signature: "3e1b9f5de8d74ec0eebe5b70e54361360be3e067adc90744345b2c906e337e9a1fe0057b665f3e101a083452fe7fed9dba06e2edfe9aa114074083a5bcf0e98a"
};

axios.post('YOUR_API_ENDPOINT', data, {
  headers: {
    'Content-Type': 'application/json',
    'X-FL-KEY': '12345678'
  }
})
.then(response => {
  console.log(response.data);
})
.catch(error => {
  console.log(error);
});
```

### PHP

```php
$url = "YOUR_API_ENDPOINT";
$payload = json_encode([
    "data" => [
        "userId" => 123,
        "clientItemId" => 4567890,
        "metadata" => [
            "value" => 2000
        ]
    ],
    "signature" => "3e1b9f5de8d74ec0eebe5b70e54361360be3e067adc90744345b2c906e337e9a1fe0057b665f3e101a083452fe7fed9dba06e2edfe9aa114074083a5bcf0e98a"
]);

$ch = curl_init($url);
curl_setopt($ch, CURLOPT_POSTFIELDS, $payload);
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Content-Type: application/json',
    'X-FL-KEY: 12345678'
]);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

$response = curl_exec($ch);
curl_close($ch);

echo $response;
```

### Python

```python
import requests

url = 'YOUR_API_ENDPOINT'
data = {
  "data": {
    "userId": 123,
    "clientItemId": 4567890,
    "metadata": {
      "value": 2000
    }
  },
  "signature": "3e1b9f5de8d74ec0eebe5b70e54361360be3e067adc90744345b2c906e337e9a1fe0057b665f3e101a083452fe7fed9dba06e2edfe9aa114074083a5bcf0e98a"
}

headers = {
    'Content-Type': 'application/json',
    'X-FL-KEY': '12345678'
}

response = requests.post(url, json=data, headers=headers)
print(response.text)
```

### CURL

```curl
curl -X POST YOUR_API_ENDPOINT \
-H "Content-Type: application/json" \
-H "X-FL-KEY: 12345678" \
-d '{
  "data": {
    "userId": 123,
    "clientItemId": 4567890,
    "metadata": {
      "value": 2000
    }
  },
  "signature": "3e1b9f5de8d74ec0eebe5b70e54361360be3e067adc90744345b2c906e337e9a1fe0057b665f3e101a083452fe7fed9dba06e2edfe9aa114074083a5bcf0e98a"
}'
```